{% extends 'base.html' %}

{% block content %}
<section id="booking-search">
<div class="container">
    <h2>Find {{ category_name|lower }} services in your area today!</h2>  
    <div class="row">
        <div class="search-form col-md-4">
            <form method="GET">
                <select name="price" id="price">
                    <option value="high">Price: Highest</option>
                    <option value="low">Price: Lowest</option>
                </select>
                <button type="submit">Sort</button>
            </form>  
        </div>
        <div class="search-taskers col-md-8">
            {% for result in results %}
            <div class="card-custom">
                <div class="picture-container">
                    <div class="picture">
                        <div class="profile-image" style="background-image: url({{ result.tasker.user.profile_picture.url }})"></div>
                        <a href="#" class="mt-4 mb-4 my-modal" data-id="{{result.tasker.user.id}}" data-toggle="modal" data-target="#tasker-{{result.id}}">View Profile & Reviews</a>
                        <a href="{% url 'booking:schedule-booking' _id=result.tasker.user.id category=result.category %}" class="btn-custom-2">Select & Continue</a>
                    </div>
                </div>
                <div class="info-1">
                   <div class="info-container">
                       <h2>{{ result.tasker }}</h2>
                       <ul>
                           <li><i class="far fa-star"></i> {{ result.tasker.rating }} / 5 positive rating</li>
                           <li><i class="far fa-check-circle"></i> {{ result.tasker.completed }} tasks successfully completed</li>
                           <li><i class="fas fa-language"></i> {{ result.tasker.user.get_language }}</li>
                       </ul>
                   </div>
                   <div class="info-price">
                        <h3>￥{{ result.price }} /hr</h3>
                   </div>
                </div>
                <div class="info-2">
                    <p>{{ result.tasker.user.bio }}</p>
                </div>
            </div>
        
        <!-- Modal -->
        <div class="modal fade" id="tasker-{{result.id}}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
            <div class="modal-content">

                <div class="modal-body d-flex flex-column align-items-center">
                    <div class="profile-image" style="background-image: url({{ result.tasker.user.profile_picture.url }})"></div>
                    <h3 class="mt-3">{{ result.tasker }} ￥{{ result.price }} /hr</h3>
                    <div class="modal-info-container">
                        <div class="modal-info-item my-3">
                            <strong>I'm the right person for the job...</strong>
                            <p>{{ result.description }}</p>
                        </div>
                        <div class="modal-info-item my-3">
                            <strong>A bit more about me...</strong>
                            <p>{{ result.tasker.user.bio }}</p>
                        </div>
                        <hr>
                        <div data-id="{{result.tasker.user.id}}" class="modal-info-item my-3">
                            
                        </div>
                    </div>
  
                </div>
                <div class="modal-footer">
                <button type="button" class="btn-custom-1" data-dismiss="modal">Close</button>
                </div>
            </div>
            </div>
        </div>

        {% endfor %}
        </div>
    </div>


</div>
</section>

{% block scripts %}

<script>

myModalLink = document.querySelectorAll('.my-modal');
allModals = document.querySelectorAll('.modal-info-item')

myModalLink.forEach(modal => {

        fetch(`ajax/reviews/${modal.dataset.id}/`)
            .then(response => response.json())
            .then(data => {
                allModals.forEach(e => {
                    if(parseInt(e.dataset.id) === data['user_id']) {
                        data['data'].forEach(review => {
                            e.innerHTML += `
                            <div>${review.rating}</div>
                            <div>${review.review}</div>


                            `
                        })
                    }
                })
            })
})



</script>
{% endblock %}

{% endblock %}